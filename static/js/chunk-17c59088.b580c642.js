(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17c59088"],{"372d":function(e,t,a){"use strict";a.r(t);var l,i,n,o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("label",{staticClass:"labelstyle"},[e._v("数据库部署：")]),a("el-button",{attrs:{loading:e.initialDBLoading,type:"primary",icon:"el-icon-circle-check"},on:{click:e.handleInitialDB}},[e._v(" "+e._s(e.$t("table.initialDB"))+" ")]),a("el-checkbox",{staticStyle:{"margin-left":"10px"},model:{value:e.isSilkScreenLine,callback:function(t){e.isSilkScreenLine=t},expression:"isSilkScreenLine"}},[e._v("丝网整线")]),a("br"),a("label",{staticClass:"labelstyle"},[e._v("数据库表信息查询：")]),a("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择表占用空间大小的界限值，标红显示"},model:{value:e.dataSize,callback:function(t){e.dataSize=t},expression:"dataSize"}},e._l(e.dataSizeOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleGetDBTablesInfo}},[e._v(" "+e._s(e.$t("table.getDBTables"))+" ")]),a("br"),a("label",{staticClass:"labelstyle"},[e._v("数据库表中数据的保留时间：")]),a("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"请选择表中记录过期时间，每天自动删除"},model:{value:e.expirationTime,callback:function(t){e.expirationTime=t},expression:"expirationTime"}},e._l(e.timeOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),a("el-switch",{staticStyle:{"margin-left":"10px"},attrs:{"active-text":"启用定时清理数据任务","active-color":"#13ce66"},on:{change:e.timerHandleSwitch},model:{value:e.dbDeleteOldDataEnable,callback:function(t){e.dbDeleteOldDataEnable=t},expression:"dbDeleteOldDataEnable"}}),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%","font-size":"15px"},attrs:{"element-loading-text":"数据正在加载中，请等候...",height:"600",data:e.showList,border:"",fit:"","highlight-current-row":"","row-style":{height:"20px"},"header-cell-style":{textAlign:"center",height:"20px"},size:"mini","cell-style":{padding:"0px"},"row-class-name":e.setRowClass}},[a("el-table-column",{key:"1",attrs:{label:"数据库名称",prop:"DatabaseName","min-width":"28%",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("span",[e._v(e._s(l.DatabaseName))])]}}])}),a("el-table-column",{key:"2",attrs:{label:"表名称",prop:"TableName","min-width":"28%",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("el-tooltip",{attrs:{content:"点击删除对应表中数据",placement:"top",effect:"light","hide-after":2500,"open-delay":500}},[a("el-tag",{staticClass:"link-type",on:{click:function(t){return e.handleTable(l)}}},[e._v(e._s(l.TableName))])],1)]}}])}),a("el-table-column",{key:"3",attrs:{label:"占用空间(M)",prop:"TableSize","min-width":"28%",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("span",[e._v(e._s(l.TableSize))])]}}])}),a("el-table-column",{key:"4",attrs:{label:"记录总数(条)",prop:"RowsCount","min-width":"28%",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("span",[e._v(e._s(l.RowsCount))])]}}])}),a("el-table-column",{key:"5",attrs:{label:"记录初始日期",prop:"MinDateTime","min-width":"28%",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("span",[e._v(e._s(null==l.MinDateTime?"--":e.$moment(l.MinDateTime).format("YYYY-MM-DD HH:mm:ss")))])]}}])}),a("el-table-column",{key:"6",attrs:{label:"记录最新日期",prop:"MaxDateTime","min-width":"28%",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("span",[e._v(e._s(null==l.MaxDateTime?"--":e.$moment(l.MaxDateTime).format("YYYY-MM-DD HH:mm:ss")))])]}}])})],1),a("el-dialog",{staticStyle:{"min-width":"500px"},attrs:{title:"删除表数据",visible:e.dialogFormVisible,width:"40%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"dataForm",staticStyle:{width:"70%","margin-left":"50px"},attrs:{model:e.temp,"label-position":"left","label-width":"85px"}},[a("el-form-item",{attrs:{label:"数据库名称",prop:"DatabaseName"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.temp.DatabaseName,callback:function(t){e.$set(e.temp,"DatabaseName",t)},expression:"temp.DatabaseName"}})],1),a("el-form-item",{attrs:{label:"表名称",prop:"TableName"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:e.temp.TableName,callback:function(t){e.$set(e.temp,"TableName",t)},expression:"temp.TableName"}})],1),a("el-form-item",{attrs:{label:"开始时间",prop:"Workline"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"请选择"},model:{value:e.temp.StartTime,callback:function(t){e.$set(e.temp,"StartTime",t)},expression:"temp.StartTime"}})],1),a("el-form-item",{attrs:{label:"结束时间",prop:"DateTime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"请选择"},model:{value:e.temp.EndTime,callback:function(t){e.$set(e.temp,"EndTime",t)},expression:"temp.EndTime"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("label",{staticStyle:{"margin-right":"100px"}},[e._v(e._s(e.handleProcessTip))]),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.deleteData()}}},[e._v(" 删除 ")])],1)],1)],1)])},r=[],s=(a("d3b7"),a("71dc")),c="darkblue-row",u={name:"",components:{},data:function(){return{initialDBLoading:!1,listLoading:!0,showList:[],temp:{DatabaseName:null,TableName:null,StartTime:null,EndTime:null},queryTemp:{DatabaseName:null,TableName:null,StartTime:null,EndTime:null},dialogFormVisible:!1,dataSizeOptions:[{label:"标红-大于200M",value:200},{label:"标红-大于500M",value:500},{label:"标红-大于1GM",value:1024},{label:"标红-大于2G",value:2048}],dataSize:500,timeOptions:[{label:"半个月",value:15},{label:"一个月",value:30},{label:"二个月",value:60},{label:"三个月",value:90},{label:"半年",value:182},{label:"一年",value:365},{label:"二年",value:730}],expirationTime:90,dbDeleteOldDataEnable:!1,handleProcessTip:"",isSilkScreenLine:!1}},created:function(){this.handleGetDBTablesInfo()},mounted:function(){},methods:{handleInitialDB:function(){var e=this;this.initialDBLoading=!0,Object(s["c"])().then((function(t){e.initialDBLoading=!1,e.$alert(t.data,"初始化数据库")})).catch((function(t){console.log(t),e.initialDBLoading=!1}))},handleGetDBTablesInfo:function(){var e=this;this.listLoading=!0,Object(s["d"])().then((function(t){e.showList=t.data,e.listLoading=!1,e.dbDeleteOldDataEnable=t.status.dbDeleteOldDataEnable,e.expirationTime=t.status.expirationTime,e.isSilkScreenLine=t.status.isSilkScreenLine,console.log(e.isSilkScreenLine)})).catch((function(e){console.log(e)})).finally((function(){e.listLoading=!1}))},setRowClass:function(e){var t=e.row,a=e.rowIndex,o=parseInt(t.TableSize);return""===t.DatabaseName?o>=this.dataSize?"lightblue-row-red":"lightblue-row-black":(0===a&&(l=n,i=c),l===t.DatabaseName?"lightblue-row"===i?o>=this.dataSize?"lightblue-row-red":"lightblue-row-black":o>=this.dataSize?"darkblue-row-red":"darkblue-row-black":(l=t.DatabaseName,"lightblue-row"===i?(i="darkblue-row",0===a&&(n=t.DatabaseName,c="darkblue-row"),o>=this.dataSize?"darkblue-row-red":"darkblue-row-black"):(0===a&&(n=t.DatabaseName,c="lightblue-row"),i="lightblue-row",o>=this.dataSize?"lightblue-row-red":"lightblue-row-black")))},handleTable:function(e){this.handleProcessTip="",this.temp.DatabaseName=e.DatabaseName,this.temp.TableName=e.TableName,this.temp.StartTime=e.MinDateTime,this.temp.EndTime=e.MaxDateTime,this.dialogFormVisible=!0},handleClose:function(e){this.$confirm("确认关闭？").then((function(t){e()})).catch((function(e){}))},deleteData:function(){var e=this;this.queryTemp=Object.assign({},this.temp),this.queryTemp.StartTime=this.$moment(this.temp.StartTime).format("YYYY-MM-DD HH:mm:ss"),this.queryTemp.EndTime=this.$moment(this.temp.EndTime).format("YYYY-MM-DD HH:mm:ss"),console.log(this.queryTemp),this.$confirm("确认要删除表数据吗？").then((function(t){e.handleProcessTip="正在删除中，请耐心等待......",Object(s["b"])(e.queryTemp).then((function(t){e.handleProcessTip="",t.data?(e.$notify({title:"删除表数据",message:"执行成功",type:"success",duration:3e3}),e.dialogFormVisible=!1):e.$notify({title:"删除表数据",message:"执行失败",type:"error",duration:3e3})}))})).catch((function(e){}))},timerHandleSwitch:function(){var e=this;this.dbDeleteOldDataEnable?this.$confirm("确认需要开启定时清理数据任务吗？").then((function(t){e.configTimer()})).catch((function(t){e.dbDeleteOldDataEnable=!1})):this.$confirm("确认需要关闭定时清理数据任务吗？").then((function(t){e.configTimer()})).catch((function(t){e.dbDeleteOldDataEnable=!0}))},configTimer:function(){var e=this,t={dbDeleteOldDataEnable:this.dbDeleteOldDataEnable,expirationTime:this.expirationTime};Object(s["a"])(t).then((function(t){t.data?e.$notify({title:"设置定时清理数据任务",message:"执行成功",type:"success",duration:3e3}):e.$notify({title:"设置定时清理数据任务",message:"执行失败",type:"error",duration:3e3})}))}}},d=u,m=(a("74af"),a("2877")),b=Object(m["a"])(d,o,r,!1,null,null,null);t["default"]=b.exports},"600a":function(e,t,a){},"71dc":function(e,t,a){"use strict";a.d(t,"e",(function(){return u})),a.d(t,"c",(function(){return d})),a.d(t,"d",(function(){return m})),a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return p})),a.d(t,"f",(function(){return h}));a("d3b7"),a("d9e2");var l=a("bc3a"),i=a.n(l),n=a("5c96"),o=a("4360"),r=a("5f87"),s=i.a.create({baseURL:"/inter",timeout:3e5});s.interceptors.request.use((function(e){return o["a"].getters.token&&Object(r["a"])()&&(e.headers["Authorization"]="Bearer "+Object(r["a"])()),e}),(function(e){return console.log(e),Promise.reject(e)})),s.interceptors.response.use((function(e){var t=e.data;return 2e4!==t.code?(Object(n["Message"])({message:t.message||"Error",type:"error",duration:5e3}),50008!==t.code&&50012!==t.code&&50014!==t.code||n["MessageBox"].confirm("You have been logged out, you can cancel to stay on this page, or log in again","Confirm logout",{confirmButtonText:"Re-Login",cancelButtonText:"Cancel",type:"warning"}).then((function(){o["a"].dispatch("user/resetToken").then((function(){location.reload()}))})),Promise.reject(new Error(t.message||"Error"))):t}),(function(e){return console.log("err"+e),Object(n["Message"])({message:e.message,type:"error",duration:5e3}),Promise.reject(e)}));var c=s;function u(){return c({url:"api/v1/equipments/status",method:"get"})}function d(){return c({url:"api/v1/database/status",method:"get"})}function m(){return c({url:"api/v1/database/status/tables",method:"get"})}function b(e){return c({url:"api/v1/database/status/settings",method:"put",data:e})}function p(e){return c({url:"api/v1/database/status/tables",method:"delete",params:e})}function h(e){return c({url:"api/v1/ip/status",method:"get",params:e})}},"74af":function(e,t,a){"use strict";a("600a")}}]);